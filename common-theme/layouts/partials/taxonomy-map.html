<div class="c-map">
  <h1 class="e-heading c-map__start is-none--lt-container">👉🏾</h1>
  <div style="height: 200px; clear: both;"></div>

  {{ $taxonomy_to_map := .Params.taxonomy_to_map }}

  {{/* You can't ask for a taxonomy to be sorted by weight, so we need to get weights and iterate ourselves - see https://discourse.gohugo.io/t/list-custom-taxonomy-terms-in-a-specific-order-not-alphabetical/18145/5 */}}
  {{ $trackKinds := $.Site.GetPage (printf "/%s" $taxonomy_to_map) }}
  {{ range $trackKindPage := $trackKinds.Pages.ByWeight }}
    {{ $trackKindTermName := $trackKindPage.Name }}
    {{ $trackKindTitle := $trackKindPage.Params.Title }}
    {{ $tracks := index (index site.Taxonomies $taxonomy_to_map) $trackKindTermName }}
    <section class="c-map__block">
      <details class="c-map__header">
        <summary class="c-map__title">
          <h2 class="e-heading">
            <a href="{{ $trackKindPage.RelPermalink }}"
              >{{ $trackKindTitle }}</a
            >
          </h2>
        </summary>
        <p class="c-map__description">
          {{ $trackKindPage.Params.Description }}
        </p>
        <dl class="c-map__terms c-terms">
          <dt>When</dt>
          <dd>{{ $trackKindPage.Params.When }}</dd>
          {{ if $trackKindPage.Params.Eligibility }}
            <dt>Who</dt>
            <dd>{{ $trackKindPage.Params.Eligibility }}</dd>
          {{ end }}
        </dl>
      </details>
      <ol class="c-map__timeline">
        {{/* Check if a menu for the current map section exists */}}
        {{ if $tracks }}
          {{/* Range over the items in the menu */}}
          {{ range $iterator, $module := $tracks }}
            <li
              class="c-map__stop"
              style="--layer:{{ sub (len $tracks) (add $iterator 1) }}">
              {{ partial "card.html" $module.Page }}
            </li>
          {{ end }}
        {{ else }}
          <li>No items found for {{ $trackKindTitle }}</li>
        {{ end }}
      </ol>
    </section>
  {{ end }}
</div>
